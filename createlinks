#!/usr/bin/perl -w

use esmith::Build::CreateLinks  qw(:all);
use File::Path;


#--------------------------------------------------
# actions for console-save event
#--------------------------------------------------
my $event = "console-save";
event_link("reset-unsavedflag", $event, "95");


#--------------------------------------------------
# actions for bootstrap-console-save event
#--------------------------------------------------
$event = "bootstrap-console-save";
event_link("reset-unsavedflag", $event, "95");


#--------------------------------------------------
# actions for group-create event
#--------------------------------------------------
event_actions('group-create', 
	      "group-create-unix" => "04",
	      'group-modify-unix' => '20',
    );


#--------------------------------------------------
# actions for group-delete event
#--------------------------------------------------
$event = "group-delete";
event_link("group-delete-unix", $event, "15");


#--------------------------------------------------
# actions for group-modify event
#--------------------------------------------------
$event = "group-modify";
event_link("group-modify-unix", $event, "15");



#--------------------------------------------------
# actions for network-create event
#--------------------------------------------------
# $event = "network-create";
# event_link("conf-routes", $event, "89");


#--------------------------------------------------
# actions for network-delete event
#--------------------------------------------------
# $event = "network-delete";
# event_link("conf-routes", $event, "89");


#--------------------------------------------------
# actions for user-create event
#--------------------------------------------------
$event = "user-create";
event_link("user-create-unix", $event, "04");
event_link("count-active-user-accounts", $event, "25");
event_link("user-group-modify", $event, "85");

#--------------------------------------------------
# actions for user-delete event
#--------------------------------------------------
$event = "user-delete";
event_link("user-delete-groups-and-pseudonyms", $event, "02");
event_link("user-delete-unix", $event, "15");
event_link("count-active-user-accounts", $event, "25");

#--------------------------------------------------
# actions for user-modify event
#--------------------------------------------------
$event = "user-modify";
event_link("user-modify-unix", $event, "15");
event_link("user-group-modify", $event, "85");


#--------------------------------------------------
# actions for user-lock event
#--------------------------------------------------
$event = "user-lock";
event_link("user-lock-unix", $event, "15");
event_link("count-active-user-accounts", $event, "25");

#--------------------------------------------------
# actions for user-lock event
#--------------------------------------------------
$event = "user-unlock";
event_link("user-unlock-unix", $event, "15");
event_link("count-active-user-accounts", $event, "25");


#--------------------------------------------------
# actions for password-modify event
#--------------------------------------------------
$event = "password-modify";
event_link("set-password", $event, "25");
event_link("delete-tmp", $event, "90");


#--------------------------------------------------
# actions for nethserver-base-update event
#--------------------------------------------------
event_actions('nethserver-base-update', 
    "initialize-default-databases"   => "00",
    "nethserver-base-selinux-setup"  => "10",
    "nethserver-base-conf"           => "40",
    "nethserver-base-pam-setup"      => "50",
    "firewall-adjust"                => "70",
    "runlevel-adjust"                => "71",
);

event_templates('nethserver-base-update', qw(
    /etc/hosts
    /etc/resolv.conf
    /etc/selinux/config
    /etc/libuser.conf
    /etc/pam.d/system-auth-nh
    /etc/pam.d/password-auth-nh
    /etc/sudoers
    /etc/sysconfig/sshd
));
		
safe_symlink("/etc/e-smith/templates-default/template-begin-pam", "root/etc/e-smith/templates/etc/pam.d/system-auth-nh/template-begin");		

#--------------------------------------------------
# actions for user-name validator
#--------------------------------------------------
validator_actions('user-name',
		  'uniq-account' => '20',
		  'user-length' => '30',
		  'max-users' => '90');

#--------------------------------------------------
# actions for group-name validator
#--------------------------------------------------
validator_actions('group-name',
		  'uniq-account' => '20',
		  'group-length' => '30');

#--------------------------------------------------
# Refs #939 tcp/udp port server validator
#--------------------------------------------------
validator_actions('remote-port',
		  'validate-remote-port', => '10');


#--------------------------------------------------
# validate passwords
#--------------------------------------------------
validator_actions('password-strength',
		  'password-strength' => '10');

#--------------------------------------------------
# nethserver-base-save event
#--------------------------------------------------
event_actions('nethserver-base-save',
	      'firewall-adjust' => '60',
	      'runlevel-adjust' => '61');

event_templates('nethserver-base-save',
		'/etc/sysconfig/sshd');


#--------------------------------------------------
# Refs #1038 expand /etc/hosts template on host 
# events
#--------------------------------------------------
templates2events('/etc/hosts', 
		 'host-create',
		 'host-delete',
		 'host-modify');


#--------------------------------------------------
# system-{start,stop} events
#--------------------------------------------------
event_actions('system-start', 'bootstrap-console' => '20');
File::Path::make_path('root/etc/e-smith/events/system-stop');

exit 0;

