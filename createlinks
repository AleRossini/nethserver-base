#!/usr/bin/perl -w

use esmith::Build::CreateLinks  qw(:all);
use File::Path;


#--------------------------------------------------
# actions for network-create event
#--------------------------------------------------
event_templates('network-create', qw(
		/etc/localnetworks
));

#--------------------------------------------------
# actions for network-modify event
#--------------------------------------------------
event_templates('network-modify', qw(
		/etc/localnetworks
));

#--------------------------------------------------
# actions for network-delete event
#--------------------------------------------------
event_templates('network-delete', qw(
		/etc/localnetworks
));

#--------------------------------------------------
# actions for nethserver-base-update event
#--------------------------------------------------
event_actions('nethserver-base-update', qw(
    initialize-default-databases      00
    nethserver-base-selinux-setup     10
    nethserver-base-conf              40
    nethserver-base-pam-setup         50
    firewall-adjust                   70
    runlevel-adjust                   71
));

event_templates('nethserver-base-update', qw(
    /etc/hosts
    /etc/resolv.conf
    /etc/selinux/config
    /etc/libuser.conf
    /etc/pam.d/system-auth-nh
    /etc/pam.d/password-auth-nh
    /etc/sudoers
    /etc/sysconfig/sshd
    /etc/localnetworks
    /etc/hosts.allow
    /etc/hosts.deny
    /etc/shells
    /etc/rc.d/rc.local
));


#
# Template headers
#
		
safe_symlink(
    "/etc/e-smith/templates-default/template-begin-pam", 
    "root/etc/e-smith/templates/etc/pam.d/system-auth-nh/template-begin");		

safe_symlink(
    "/etc/e-smith/templates-default/template-begin-shell", 
    "root/etc/e-smith/templates/etc/rc.d/rc.local/template-begin");		


#--------------------------------------------------
# actions for interface-modify event #1532
#--------------------------------------------------
event_actions('interface-update', qw(
              interface-config-reset     25
              interface-config-write     30
              interface-config-restart   70
              interface-config-hostname  75
));

event_templates('interface-update', qw(
     /etc/modprobe.d/bonding.conf
     /etc/udev/rules.d/70-persistent-net.rules
     /etc/sysconfig/network
     /etc/localnetworks
     /etc/hosts
));


#--------------------------------------------------
# Refs #939 tcp/udp port server validator
#--------------------------------------------------
validator_actions('remote-port', qw(
		  open-tcp-connection 10
));


#--------------------------------------------------
# nethserver-base-save event
#--------------------------------------------------
event_templates('nethserver-base-save', qw(
		/etc/hosts.allow
		/etc/hosts.deny
		/etc/sysconfig/sshd
));

event_actions('nethserver-base-save', qw(
	      firewall-adjust 60
	      runlevel-adjust 61
));

event_services('nethserver-base-save', qw(
               sshd restart
));

#--------------------------------------------------
# Refs #1038 expand /etc/hosts template on host 
# events -- FIXME: should be moved into 
# nethserver-hosts package (?)
#--------------------------------------------------
templates2events('/etc/hosts', qw(
		 host-create
		 host-delete
		 host-modify
));


#--------------------------------------------------
# system-{start,stop} events
#--------------------------------------------------
File::Path::make_path('root/etc/e-smith/events/system-start',
		      'root/etc/e-smith/events/system-stop');

#--------------------------------------------------
# actions for first-boot event
#--------------------------------------------------
event_actions('first-boot', qw(
    initialize-default-databases      00
    rebrand 			      10
    bootstrap-console-start           50
));

exit 0;

