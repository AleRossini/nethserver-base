Name: nethserver-base
Summary: NethServer basic configuration
Version: @@VERSION@@
Release: @@RELEASE@@
License: GPL
Source: %{name}-%{version}.tar.gz
BuildArch: noarch
URL: %{url_prefix}/%{name} 

Requires: initscripts
Requires: perl(Locale::gettext)
Requires: perl(Crypt::Cracklib)
Requires: perl(Date::Manip)
Requires: perl(Data::UUID)
Requires: perl(Net::IPv4Addr)
Requires: perl-TimeDate
Requires: perl-DateTime-Format-Mail
Requires: perl-Mail-RFC822-Address
Requires: smartmontools
Requires: dbus
Requires: hal
Requires: acpid
Requires: bridge-utils
Requires: vconfig
Requires: mdadm
Requires: libuser >= 0.56
Requires: sudo
Requires: perl-suidperl
Requires: nc
Requires: iproute
Requires: postfix

Requires: nethserver-yum > 1.0.1-1
Requires: nethserver-lib > 1.1.0-4

BuildRequires: nethserver-devtools
BuildRequires: gettext

%description 
The %{name} package provides the fundamental infrastructure for the
configuration management of NethServer, derived from SME Server event
and template system.

%prep
%setup

%pre
# ensure admin user exists:
if ! id admin >/dev/null 2>&1 ; then
   useradd -M admin
fi

%post

%build

perl createlinks

# davidep: relocate perl modules under default perl vendorlib directory:
mkdir -p root%{perl_vendorlib}
mv -v esmith root%{perl_vendorlib}

for f in `/bin/ls root/usr/share/locale/*/LC_MESSAGES/server-console.po`; do
   out=`dirname $f`
   /usr/bin/msgfmt $f -o $out/server-console.mo
   rm -f $f
done


%install
rm -rf $RPM_BUILD_ROOT
(cd root   ; find . -depth -not -name '*.orig' -print  | cpio -dump $RPM_BUILD_ROOT)
%{genfilelist} $RPM_BUILD_ROOT > %{name}-%{version}-%{release}-filelist
echo "%doc COPYING"          >> %{name}-%{version}-%{release}-filelist

%clean 
rm -rf $RPM_BUILD_ROOT

%files -f %{name}-%{version}-%{release}-filelist
%defattr(-,root,root)

%changelog
* Tue Apr 30 2013 Giacomo Sanchietti <giacomo.sanchietti@nethesis.it> - 1.2.0-1.ns6
- Rebuild for automatic package handling. #1870
- Refactor firewall configuration #1875
- Add logviewer module #470
- Handle static routes #1886
- Add migration code #1794
- Various fixes: #1754 #1878

* Tue Mar 19 2013 Giacomo Sanchietti <giacomo.sanchietti@nethesis.it> - 1.1.2-1.ns6
- first-boot: postpone init-repo execution to avoid clean up of event-queue

* Tue Mar 19 2013 Giacomo Sanchietti <giacomo.sanchietti@nethesis.it> - 1.1.1-1.ns6
- New dashboard #583
- first-boot event: execute network restart (#1741) do not block on error
- Add migration code #1702
- Add support for filesystems options #1658
- Various bugfixes

* Thu Jan 31 2013 Davide Principi <davide.principi@nethesis.it> - 1.1.0-1.ns6
- Removed "pv" requirement
- Added Certificate Management #1503
- SME bash completion #1619
- admin's mailbox #1635
- Fix #1628 


